{% load static %}
<div class="hidden relative sm:inline-block text-left" id="dropdownMenu">
  <div
    class="cursor-pointer inline-flex justify-center rounded-xl items-center w-full px-4 py-2 text-sm font-bold text-color_text bg-color_btn_inp_bor hover:bg-color_btn_hover"
  >
    <p class="hidden lg:block">Пользователь</p>
    <img class="w-4 h-4 lg:ml-4" src="{% static 'icons/user.png' %}" alt="" />
  </div>

  <!-- Dropdown menu -->
  <div id="menu" class="absolute hidden left-0 mt-4 origin-top-left bg-color_btn_inp_bor rounded-md shadow-lg">
    <div class="py-1 flex flex-col">
      {% if request.user.is_authenticated %}
      <a class="text-color_link p-4 hover:text-color_link_hover" href="{% url user_menu.0.url_name %}">
        {{ user_menu.0.name }}
      </a>
      {% else %}
      <a class="text-color_link p-4 hover:text-color_link_hover" href="{% url user_menu.1.url_name %}">
        {{ user_menu.1.name }}
      </a>
      <a class="text-color_link m-4 hover:text-color_link_hover" href="{% url user_menu.2.url_name %}">
        {{ user_menu.2.name }}
      </a>
      {% endif %}
    </div>
  </div>
</div>

<script>
  const menu = document.getElementById("menu");
  const dropdownMenu = document.getElementById("dropdownMenu");

  // Переключение меню
  const toggleMenu = () => {
    menu.classList.toggle("hidden");
    menu.classList.toggle("flex");
  };

  // Клик по кнопке меню
  dropdownMenu.addEventListener("click", (event) => {
    event.stopPropagation();
    toggleMenu();
  });

  // Клик в любом месте документа
  document.addEventListener("click", (event) => {
    if (!menu.classList.contains("hidden") && !menu.contains(event.target) && event.target !== dropdownMenu) {
      toggleMenu();
    }
  });

  // Закрытие по Esc
  document.addEventListener("keydown", (event) => {
    if (event.key === "Escape" && !menu.classList.contains("hidden")) {
      toggleMenu();
    }
  });
</script>
